(()=>{"use strict";function e(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(e)}function n(e){var n=function(e,n){if("object"!=t(e)||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,"string");if("object"!=t(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==t(n)?n:n+""}function i(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,n(r.key),r)}}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function o(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?r(Object(i),!0).forEach((function(t){var r,o,a;r=e,o=t,a=i[t],(o=n(o))in r?Object.defineProperty(r,o,{value:a,enumerable:!0,configurable:!0,writable:!0}):r[o]=a})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):r(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}var a=function(){return e=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.endpoint=t.endpoint||"https://vf7vx6k4t2.execute-api.ap-northeast-2.amazonaws.com/prod",this.version=t.version||"1.0.0",this.sessionTimeout=t.sessionTimeout||360,this.cookieMaxAge=t.cookieMaxAge||604800,this.refer="",this.userId=t.userId||"",this.deviceId=t.deviceId||"",this.lang=t.lang||navigator.language||"",this.country=t.country||"",this.init()},t=[{key:"init",value:function(){var e=this;window.addEventListener("pushState",(function(){return e.onPageEnterAndLeave("pushState")})),window.addEventListener("popstate",(function(){return e.onPageEnterAndLeave("popstate")})),window.onbeforeunload=function(){e.onPageClose()},this.startSession(),this.onPageEnter()}},{key:"onPageEnterAndLeave",value:function(e){var t=this.getRouteStack()||[],n=t.length;"replaceState"!==e||t[n-1]&&t[n-1]!==window.location.href?(this.onPageLeave(),this.onPageEnter(),n>5&&t.shift(),t.push(window.location.href),this.setRouteStack(t)):console.info("tracker: eventName --\x3e replaceState fix 无需埋点")}},{key:"onPageEnter",value:function(){var e=this.getRouteStack()||[],t=e.length;if(this.refer=t?e[t-1]:"",this.preCallApi()){var n=(new Date).getTime(),i={};i.page=window.location.href,i.event_type="enter",i.event_name="page_enter",i.params=JSON.stringify(s(window.location.href)),this.setPageStartTime(),this.sendData(i),this.updatePreVisitTime(n)}}},{key:"onPageLeave",value:function(){var e=this.getRouteStack()||[],t=e.length;if(t&&(this.refer=e[t-2],this.preCallApi())){var n=(new Date).getTime(),i={};i.page=e[t-1],i.event_type="leave",i.event_name="page_leave",i.params=JSON.stringify(o(o({},s(i.page)),{},{duration:this.getPageStartTime()?Date.now()-this.getPageStartTime():""})),this.sendData(i),this.updatePreVisitTime(n)}}},{key:"onPageClose",value:function(){if(this.preCallApi()){var e=(new Date).getTime(),t={};t.page=window.location.href,t.event_type="leave",t.event_name="page_close",t.args=JSON.stringify(s(window.location.href)),t.params={duration:this.getPageStartTime()?Date.now()-this.getPageStartTime():""},this.sendData(t),this.updatePreVisitTime(e)}}},{key:"onEvent",value:function(e){var t=this,n={};if(n.page=window.location.href,e)for(var i in e)i&&e[i]&&(n[i]=e[i]);if(this.preCallApi()){var r=(new Date).getTime();this.sendData(n).then((function(){t.updatePreVisitTime(r)}))}}},{key:"completeFields",value:function(e){return o(o({},{timestamp:(new Date).toISOString(),page:window.location.href,device:/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?"mobile":"desktop",browser:navigator.userAgent,os:navigator.platform,referer:document.referer||"",session_id:this.getSessionId(),user_id:this.userId,deviceid:this.deviceId,refer:this.refer,dpi:window.devicePixelRatio,resolution:window.screen.availWidth+"*"+window.screen.availHeight,sdk_type:"JS",sdk_version:"1.0.0"}),e)}},{key:"sendData",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new Promise((function(n,i){var r=e.completeFields(t),o={content:JSON.stringify(r)};fetch(e.endpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)}).then((function(e){if(!e.ok)throw new Error("Network response was not ok")})).then((function(e){n(e)})).catch((function(e){i(e)}))}))}},{key:"updatePreVisitTime",value:function(e){u("preVisitTme",e,this.cookieMaxAge)}},{key:"setPageStartTime",value:function(){sessionStorage.setItem("pageStartTime",Date.now())}},{key:"getPageStartTime",value:function(){return sessionStorage.getItem("pageStartTime")}},{key:"setRouteStack",value:function(e){sessionStorage.setItem("routeStack",JSON.stringify(e))}},{key:"getRouteStack",value:function(){var e=sessionStorage.getItem("routeStack");return e&&JSON.parse(e)}},{key:"startSession",value:function(){this.getSessionId()?this.isSessionTimeout()?this.createNewSession():this.updatePreVisitTime((new Date).getTime()):this.createNewSession()}},{key:"generateId",value:function(){var e,t=[];t[8]=t[13]=t[18]=t[23]="-",t[14]="4";for(var n=0;n<36;n++)t[n]||(e=0|16*Math.random(),t[n]="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz"[19===n?3&e|8:e]);return t.join("")}},{key:"getSessionId",value:function(){return c("sessionId")}},{key:"setSessionId",value:function(e){e&&u("sessionId",e,this.cookieMaxAge)}},{key:"getUserId",value:function(){return this.userId}},{key:"setUserId",value:function(e){this.userId=e}},{key:"getDeviceId",value:function(){return this.deviceId}},{key:"setDeviceId",value:function(e){this.deviceId=e}},{key:"createNewSession",value:function(){var e=(new Date).getTime(),t=this.generateId();this.setSessionId(t),this.updatePreVisitTime(e)}},{key:"isSessionTimeout",value:function(){var e=(new Date).getTime(),t=c("preVisitTime");return!t||e-t>1e3*this.sessionTimeout}},{key:"preCallApi",value:function(){return this.isSessionTimeout()?this.startSession():this.updatePreVisitTime((new Date).getTime()),!0}}],t&&i(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function s(t){return((t||window.location.href).match(/[?&][^=]*=[^?&=]*/g)||[]).reduce((function(t,n){var i,r,o=(i=n.slice(1).split("="),r=2,function(e){if(Array.isArray(e))return e}(i)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,r,o,a,s=[],u=!0,c=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(i=o.call(n)).done)&&(s.push(i.value),s.length!==t);u=!0);}catch(e){c=!0,r=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw r}}return s}}(i,r)||function(t,n){if(t){if("string"==typeof t)return e(t,n);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?e(t,n):void 0}}(i,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),a=o[0],s=o[1];return t[a]=s,t}),{})}function u(e,t,n){var i="";if(n){var r=new Date;r.setTime(r.getTime()+24*n*60*60*1e3),i="; expires="+r.toUTCString()}document.cookie=e+"="+(t||"")+i+"; path=/"}function c(e){for(var t=e+"=",n=document.cookie.split(";"),i=0;i<n.length;i++){for(var r=n[i];" "==r.charAt(0);)r=r.substring(1,r.length);if(0==r.indexOf(t))return r.substring(t.length,r.length)}return null}var l,f={pushState:new Event("pushState"),replaceState:new Event("replaceState")};function h(e){var t=history[e];return function(){t.apply(this,arguments),window.dispatchEvent(f[e])}}function v(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,t="",n=0;n<e;n++){var i=Math.floor(10*Math.random());t+="0123456789".charAt(i)}return t}history.pushState=h("pushState"),history.replaceState=h("replaceState");const p=(l||(l=new a({userId:v(5),deviceId:v(5),lang:"en",country:"kr",sessionTimeout:360})),l);window.__TRACKER__={startSession:function(){p.startSession()},onPageClose:function(){p.onPageClose()},onPageEnter:function(){p.onPageEnter()},onPageLeave:function(){p.onPageLeave()},onEvent:function(e){p.onEvent(e)}}})();